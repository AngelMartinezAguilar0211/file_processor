<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resultados del Procesamiento - File Processor</title>
  </head>
  <body>
    <div class="main-container">
      <header class="header">
        <div class="logo">File Processor</div>
        <nav class="nav">
          <a href="/">Inicio</a>
          <a href="#">InformaciÃ³n</a>
        </nav>
      </header>

      <h1 class="main-title">Resultados del Procesamiento</h1>

      <%= if @resultado[:benchmark] do %>
        <!-- Vista de resultados de Benchmark -->
        <div class="results-container benchmark-results">
          <div class="section-header">
            <h2>Benchmark Completado</h2>
            <span class="status-badge success">Exitoso</span>
          </div>

          <div class="benchmark-output">
            <pre><%= @resultado[:resultado] %></pre>
          </div>

          <div class="action-buttons">
            <a href="/" class="btn-primary">Nuevo Procesamiento</a>
          </div>
        </div>
      <% else %>
        <!-- Vista de resultados normales -->
        <div class="results-container">
          <!-- SecciÃ³n de MÃ©tricas Resumidas -->
          <div class="metrics-summary">
            <div class="metric-card">
              <div class="metric-label">Archivos Procesados</div>
              <div class="metric-value">{@resultado[:metricas][:archivos_procesados]}</div>
            </div>

            <%= if @resultado[:metricas][:archivos_csv] > 0 do %>
              <div class="metric-card">
                <div class="metric-label">Archivos CSV</div>
                <div class="metric-value">{@resultado[:metricas][:archivos_csv]}</div>
              </div>
            <% end %>

            <%= if @resultado[:metricas][:archivos_json] > 0 do %>
              <div class="metric-card">
                <div class="metric-label">Archivos JSON</div>
                <div class="metric-value">{@resultado[:metricas][:archivos_json]}</div>
              </div>
            <% end %>

            <%= if @resultado[:metricas][:archivos_log] > 0 do %>
              <div class="metric-card">
                <div class="metric-label">Archivos LOG</div>
                <div class="metric-value">{@resultado[:metricas][:archivos_log]}</div>
              </div>
            <% end %>

            <div class="metric-card">
              <div class="metric-label">Tiempo de Procesamiento</div>
              <div class="metric-value">
                {Float.round(@resultado[:metricas][:tiempo_procesamiento], 2)}s
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-label">Tasa de Ã‰xito</div>
              <div class="metric-value success-rate">
                {Float.round(@resultado[:metricas][:tasa_exito], 1)}%
              </div>
            </div>
          </div>
          
<!-- InformaciÃ³n del Procesamiento -->
          <div class="processing-info">
            <div class="info-row">
              <span class="info-label">Modo de Procesamiento:</span>
              <span class="info-value">{String.capitalize(@resultado[:modo])}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Ruta del Reporte:</span>
              <span class="info-value code">{Path.basename(@resultado[:ruta_reporte])}</span>
            </div>
          </div>
          
<!-- Tabs para ver el reporte -->
          <div class="tabs-container">
            <div class="tabs-header">
              <button class="tab-button active" onclick="showTab('resumen')">Resumen</button>
              <button class="tab-button" onclick="showTab('completo')">Reporte Completo</button>
            </div>
            
<!-- Tab Resumen -->
            <div id="tab-resumen" class="tab-content active">
              <div class="summary-section">
                <h3>Resumen Ejecutivo</h3>
                <pre><%= extraer_seccion_resumen(@resultado[:contenido]) %></pre>
              </div>
            </div>
            
<!-- Tab Reporte Completo -->
            <div id="tab-completo" class="tab-content">
              <div class="report-viewer">
                <div class="report-controls">
                  <button onclick="copiarReporte()" class="btn-secondary">
                    ðŸ“‹ Copiar Reporte
                  </button>
                  <a
                    href={"/" <> String.replace(@resultado[:ruta_reporte], "priv/static/", "")}
                    download
                    class="btn-secondary"
                  >
                    ðŸ’¾ Descargar Reporte
                  </a>
                </div>
                <pre class="report-content" id="reporte-completo"><%= @resultado[:contenido] %></pre>
              </div>
            </div>
          </div>
          
<!-- Botones de acciÃ³n -->
          <div class="action-buttons">
            <a href="/" class="btn-primary">Procesar Nuevo Archivo</a>
          </div>
        </div>
      <% end %>
    </div>

    <script>
      // FunciÃ³n para cambiar entre tabs
      function showTab(tabName) {
          // Ocultar todos los tabs
          document.querySelectorAll('.tab-content').forEach(tab => {
              tab.classList.remove('active');
          });

          // Desactivar todos los botones
          document.querySelectorAll('.tab-button').forEach(button => {
              button.classList.remove('active');
          });

          // Mostrar el tab seleccionado
          document.getElementById('tab-' + tabName).classList.add('active');

          // Activar el botÃ³n correspondiente
          event.target.classList.add('active');
      }

      // FunciÃ³n para copiar el reporte al portapapeles
      function copiarReporte() {
          const reporte = document.getElementById('reporte-completo').textContent;

          navigator.clipboard.writeText(reporte).then(() => {
              // Mostrar feedback visual
              const boton = event.target;
              const textoOriginal = boton.textContent;
              boton.textContent = 'âœ“ Copiado!';
              boton.classList.add('success');

              setTimeout(() => {
                  boton.textContent = textoOriginal;
                  boton.classList.remove('success');
              }, 2000);
          }).catch(err => {
              alert('Error al copiar: ' + err);
          });
      }
    </script>

    <style>
      /* Estilos adicionales especÃ­ficos para la pÃ¡gina de resultados */
      .results-container {
          background: white;
          border-radius: 12px;
          padding: 2rem;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          margin-top: 2rem;
      }

      .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #e5e7eb;
      }

      .section-header h2 {
          font-size: 1.5rem;
          font-weight: 600;
          color: #1f2937;
          margin: 0;
      }

      .status-badge {
          padding: 0.5rem 1rem;
          border-radius: 20px;
          font-size: 0.875rem;
          font-weight: 600;
      }

      .status-badge.success {
          background: #d1fae5;
          color: #065f46;
      }

      /* MÃ©tricas en Cards */
      .metrics-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 1rem;
          margin-bottom: 2rem;
      }

      .metric-card {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          padding: 1.5rem;
          border-radius: 10px;
          color: white;
          text-align: center;
      }

      .metric-label {
          font-size: 0.875rem;
          opacity: 0.9;
          margin-bottom: 0.5rem;
      }

      .metric-value {
          font-size: 2rem;
          font-weight: 700;
      }

      .success-rate {
          color: #10b981;
      }

      /* InformaciÃ³n del procesamiento */
      .processing-info {
          background: #f9fafb;
          padding: 1.5rem;
          border-radius: 8px;
          margin-bottom: 2rem;
      }

      .info-row {
          display: flex;
          justify-content: space-between;
          padding: 0.5rem 0;
      }

      .info-label {
          font-weight: 600;
          color: #6b7280;
      }

      .info-value {
          color: #1f2937;
      }

      .info-value.code {
          font-family: 'Courier New', monospace;
          background: #e5e7eb;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
      }

      /* Tabs */
      .tabs-container {
          margin-bottom: 2rem;
      }

      .tabs-header {
          display: flex;
          gap: 0.5rem;
          border-bottom: 2px solid #e5e7eb;
          margin-bottom: 1rem;
      }

      .tab-button {
          padding: 0.75rem 1.5rem;
          border: none;
          background: transparent;
          color: #6b7280;
          font-weight: 500;
          cursor: pointer;
          border-bottom: 3px solid transparent;
          transition: all 0.2s;
      }

      .tab-button:hover {
          color: #667eea;
      }

      .tab-button.active {
          color: #667eea;
          border-bottom-color: #667eea;
      }

      .tab-content {
          display: none;
      }

      .tab-content.active {
          display: block;
      }

      /* Reporte Viewer */
      .report-viewer {
          background: #1e293b;
          border-radius: 8px;
          padding: 1.5rem;
      }

      .report-controls {
          display: flex;
          gap: 1rem;
          margin-bottom: 1rem;
      }

      .report-content {
          background: #0f172a;
          color: #e2e8f0;
          padding: 1.5rem;
          border-radius: 6px;
          overflow-x: auto;
          font-family: 'Courier New', monospace;
          font-size: 0.875rem;
          line-height: 1.6;
          max-height: 600px;
          overflow-y: auto;
      }

      /* Resumen */
      .summary-section {
          background: #f9fafb;
          padding: 1.5rem;
          border-radius: 8px;
      }

      .summary-section h3 {
          margin-top: 0;
          color: #1f2937;
      }

      .summary-section pre {
          background: white;
          padding: 1rem;
          border-radius: 6px;
          border-left: 4px solid #667eea;
          overflow-x: auto;
      }

      /* Botones de acciÃ³n */
      .action-buttons {
          display: flex;
          gap: 1rem;
          justify-content: center;
          margin-top: 2rem;
          padding-top: 2rem;
          border-top: 1px solid #e5e7eb;
      }

      .btn-primary, .btn-secondary {
          padding: 0.75rem 2rem;
          border-radius: 8px;
          font-weight: 600;
          text-decoration: none;
          display: inline-block;
          transition: all 0.2s;
          border: none;
          cursor: pointer;
      }

      .btn-primary {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
      }

      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
          background: white;
          color: #667eea;
          border: 2px solid #667eea;
      }

      .btn-secondary:hover {
          background: #667eea;
          color: white;
      }

      .btn-secondary.success {
          background: #10b981;
          color: white;
          border-color: #10b981;
      }

      /* Benchmark Output */
      .benchmark-output {
          background: #1e293b;
          color: #e2e8f0;
          padding: 2rem;
          border-radius: 8px;
          margin: 2rem 0;
      }

      .benchmark-output pre {
          margin: 0;
          font-family: 'Courier New', monospace;
          white-space: pre-wrap;
          word-wrap: break-word;
      }
    </style>
  </body>
</html>
