<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Processor - Dashboard</title>
  </head>
  <body>
    <div class="main-container">
      <header class="header">
        <div class="logo">File Processor</div>
        <nav class="nav">
          <a href="/">Inicio</a>
          <a href="/historial">Historial</a>
        </nav>
      </header>

      <h1 class="main-title">
        Obt√©n m√©tricas relevantes para archivos con extensi√≥n csv, json y log
      </h1>
      <%= if Phoenix.Flash.get(@flash, :error) do %>
        <div style="background-color: #fef2f2; border-left: 4px solid #ef4444; color: #b91c1c; padding: 1rem; margin-bottom: 2rem; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 100%; max-width: 800px; margin-left: auto; margin-right: auto;">
          <div style="display: flex; align-items: flex-start;">
            <span style="font-size: 1.25rem; margin-right: 0.75rem;">‚ö†Ô∏è</span>
            <div style="font-family: inherit; line-height: 1.5;">
              {Phoenix.Flash.get(@flash, :error)}
            </div>
          </div>
        </div>
      <% end %>

      <%= if Phoenix.Flash.get(@flash, :info) do %>
        <div style="background-color: #f0fdf4; border-left: 4px solid #22c55e; color: #15803d; padding: 1rem; margin-bottom: 2rem; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 100%; max-width: 800px; margin-left: auto; margin-right: auto;">
          <div style="display: flex; align-items: flex-start;">
            <span style="font-size: 1.25rem; margin-right: 0.75rem;">‚úÖ</span>
            <div style="white-space: pre-wrap; font-family: inherit; line-height: 1.5;">
              {Phoenix.Flash.get(@flash, :info)}
            </div>
          </div>
        </div>
      <% end %>
      <form action="/procesar" method="POST" enctype="multipart/form-data" class="processor-form">
        <input type="hidden" name="_csrf_token" value={Plug.CSRFProtection.get_csrf_token()} />

        <div class="form-grid">
          <div class="upload-section">
            <div class="drop-zone">
              <div class="icon-cloud">‚òÅÔ∏è</div>
              <p class="file-types-text">CSV, JSON, LOG</p>

              <button
                type="button"
                class="btn-upload"
                onclick="document.getElementById('file-input').click()"
              >
                Cargar Archivos
              </button>
              <input
                type="file"
                id="file-input"
                name="archivos_subidos[]"
                multiple
                style="display: none;"
                accept=".csv, .json, .log"
              />

              <div id="file-list" style="margin-top: 10px;"></div>

              <p class="path-divider">o escribe la ruta de tu archivo aqu√≠:</p>

              <input
                type="text"
                name="ruta_archivo"
                class="input-path"
                placeholder="C:\usuarios\documentos\archivo.csv"
              />
            </div>
          </div>

          <div class="options-section">
            <h2 class="section-label">Opciones</h2>

            <p class="input-label-small">Tipo de Procesamiento</p>
            <div class="processing-cards">
              <div class="card">
                <input
                  type="radio"
                  name="processing_type"
                  value="secuencial"
                  id="secuencial"
                  checked
                />
                <label for="secuencial">
                  <span class="radio-dot"></span> Secuencial
                </label>
              </div>
              <div class="card">
                <input type="radio" name="processing_type" value="paralelo" id="paralelo" />
                <label for="paralelo">
                  <span class="radio-dot"></span> Paralelo
                </label>
              </div>
            </div>

            <div class="benchmark-row">
              <span class="benchmark-text">Benchmark</span>
              <label class="switch">
                <input type="checkbox" name="benchmark_active" />
                <span class="slider"></span>
              </label>
            </div>

            <h2 class="section-label">Detalles</h2>
            <div class="details-grid">
              <input
                type="text"
                name="report_name"
                placeholder="Nombre del reporte"
                class="input-field"
              />
              <input
                type="text"
                name="retry_count"
                placeholder="Reintentos por Archivo"
                class="input-field"
              />
              <input type="text" name="max_workers" placeholder="Max Workers" class="input-field" />
              <input type="text" name="timeout" placeholder="Timeout (ms)" class="input-field" />
            </div>
          </div>
        </div>

        <div class="footer-action">
          <button type="submit" class="btn-submit">Iniciar Proceso</button>
        </div>
      </form>
    </div>

    <script>
      // Mostrar los nombres de los archivos seleccionados
      document.getElementById('file-input').addEventListener('change', function(e) {
          const files = e.target.files;
          const fileList = document.getElementById('file-list');

          if (files.length === 0) {
              fileList.innerHTML = '';
              return;
          }

          // Crear lista de archivos
          let html = '<div style="background: #f0f4ff; padding: 12px; border-radius: 8px; border-left: 4px solid #667eea;">';
          html += `<div style="font-weight: 600; color: #667eea; margin-bottom: 8px;">üìÅ ${files.length} archivo(s) seleccionado(s):</div>`;
          html += '<ul style="margin: 0; padding-left: 20px; color: #4a5568;">';

          for (let i = 0; i < files.length; i++) {
              const file = files[i];
              const size = (file.size / 1024).toFixed(1); // KB
              html += `<li style="margin: 4px 0;">${file.name} <span style="color: #718096; font-size: 0.85em;">(${size} KB)</span></li>`;
          }

          html += '</ul></div>';
          fileList.innerHTML = html;
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const benchmarkToggle = document.querySelector('input[name="benchmark_active"]');
        const opcionesConcurrencia = document.querySelector('.processing-cards');
        const labelConcurrencia = document.querySelector('.input-label-small');

        if (benchmarkToggle && opcionesConcurrencia) {
          benchmarkToggle.addEventListener("change", function() {
            if (this.checked) {
              opcionesConcurrencia.style.display = "none";
              if (labelConcurrencia) labelConcurrencia.style.display = "none";
            } else {
              opcionesConcurrencia.style.display = "flex";
              if (labelConcurrencia) labelConcurrencia.style.display = "block";
            }
          });
        }
      });
    </script>
  </body>
</html>
